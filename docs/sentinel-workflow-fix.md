# Azure Sentinel Deployment Workflow Fix

## Issue
The Azure Sentinel deployment workflow was configured to scan **all files** in the repository (`- '**'`), causing it to attempt deploying non-Sentinel files like:
- `package-lock.json`
- `.vscode/tasks.json`
- `docs/screenshots/summary.json`
- `tmp/*.json`

This caused errors like:
```
Error: Failed to check valid resource type.
ConvertFrom-Json: The provided JSON includes a property whose name is an empty string
```

## Root Cause
The workflow at `.github/workflows/sentinel-deploy-7a6e3376-ab8c-4bfe-8d27-ba2f9acff6f2.yml` was scanning the entire repository instead of just Sentinel content directories.

## Solution Applied
Updated the workflow trigger paths to only monitor Sentinel-specific directories:

```yaml
on:
  push:
    branches: [ main ]
    paths:
    - 'Sentinel/**'           # Main Sentinel content directory
    - 'Detections/**'         # Detection rules
    - 'Playbooks/**'          # Logic Apps playbooks
    - 'Workbooks/**'          # Sentinel workbooks
    - 'Parsers/**'            # KQL parsers
    - 'HuntingQueries/**'     # Hunting queries
    - '!.github/workflows/**' # Exclude workflow changes
    - '.github/workflows/sentinel-deploy-7a6e3376-ab8c-4bfe-8d27-ba2f9acff6f2.yml'
```

## What This Fixes
1. ✅ Prevents deployment attempts on non-Sentinel JSON files
2. ✅ Stops `ConvertFrom-Json` errors on `package-lock.json`
3. ✅ Reduces unnecessary workflow runs
4. ✅ Improves CI/CD pipeline efficiency
5. ✅ Only triggers on actual Sentinel content changes

## Alternative Solutions

### Option 1: Disable the Workflow (if not needed)
If you're not using Azure Sentinel with this repository, you can disable the workflow:

```bash
# Move it to a disabled folder
mkdir -p .github/workflows-disabled
mv .github/workflows/sentinel-deploy-*.yml .github/workflows-disabled/
```

### Option 2: Create Sentinel Content Directory
If you do use Sentinel, organize your content:

```bash
mkdir -p Sentinel/{Detections,Playbooks,Workbooks,Parsers,HuntingQueries}
```

Then place your Sentinel ARM templates in the appropriate directories.

### Option 3: Add Exclusions to .gitignore
Prevent Sentinel tracking files from being committed:

```gitignore
# Sentinel deployment tracking
.sentinel/
sentinel-deployment.config
```

## Testing
After applying this fix:

1. The workflow will **only** run when files in Sentinel content directories change
2. Changes to `src/`, `docs/`, `tmp/`, `.vscode/`, etc. will **not** trigger the workflow
3. The `ConvertFrom-Json` error on `package-lock.json` will not occur

## Verification
To verify the fix is working:

```bash
# Check workflow trigger conditions
cat .github/workflows/sentinel-deploy-7a6e3376-ab8c-4bfe-8d27-ba2f9acff6f2.yml | grep -A 10 "paths:"

# Expected output should show only Sentinel directories
```

## Related Files
- `.github/workflows/sentinel-deploy-7a6e3376-ab8c-4bfe-8d27-ba2f9acff6f2.yml` - Workflow definition (FIXED)
- `.github/workflows/azure-sentinel-deploy-7a6e3376-ab8c-4bfe-8d27-ba2f9acff6f2.ps1` - PowerShell deployment script

## Notes
- This repository is primarily a **Next.js application** for Microsoft cloud administration
- Azure Sentinel integration appears to be ancillary or for testing purposes
- If Sentinel integration is not needed, consider removing the workflow entirely
- The workflow was likely auto-generated by Azure Sentinel and needs customization for non-Sentinel repos

## Recommended Next Steps
1. ✅ **Applied**: Update path filters to Sentinel directories only
2. Consider: Review if Sentinel integration is actually needed
3. Consider: Create proper Sentinel content directory structure if needed
4. Consider: Add `.sentinel/` to `.gitignore`
